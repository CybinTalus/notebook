<%
  raw_model = content.is_a?(ContentSerializer) ? content.raw_model : content
%>

<div id="<%= category[:name].gsub("'", '') %>_panel" class="panel card" style="display: none">
  <div class="<%= raw_model.class.color %>-text text-darken-1 section-title sticky-below-navbar <%= raw_model.class.color %> lighten-5">
    <i class="material-icons right"><%= category[:icon] %></i>
    <%= category[:label] %>
  </div>

  <div class="card-content">
    <% if category[:name] == 'gallery' %>
      <%= render partial: 'content/form/gallery/panel', locals: { f: f, content: content } %>
    <% end %>

    <% if category[:name] == 'contributors' %>
      <%= render partial: 'content/form/contributors', locals: { f: f, content: content } %>
    <% end %>

    <% category[:fields].each do |field| %>
      <% next if !!field[:hidden] %>

      <div class="panel-field autosave-field">
        <% if field[:type] == 'link' %>
          <%=
            render partial: 'content/form/field_types/legacy_link', locals: {
              f: f,
              attribute: field[:old_column_source],
              label:     field[:label],
              relation:  raw_model.class.reflect_on_association(field[:old_column_source]).options[:through].to_s
            }
          %>

        <% elsif field[:type] == 'tags' %>
          <%= 
            render partial: 'content/form/field_types/tags', locals: {
              f:     f,
              page:  @content,
              field: field
            }
          %>

        <% elsif field[:type] == 'universe' %>
          <%=
            render partial: 'content/form/field_types/universe', locals: {
              f:         f,
              field:     field,
              page:      @content,
              raw_model: raw_model
            }
          %>

        <% elsif field[:type] == 'name' %>
          <%=
            render partial: 'content/form/field_types/name', locals: {
              f:       f,
              content: @content,
              field:   field
            }
          %>

        <% else %>
          <%=
            render partial: 'content/form/field_types/text', locals: {
              f:         f,
              content:   @content,
              raw_model: raw_model,
              field:     field,
            }
          %>
        <% end %>

      </div>
    <% end %>
  </div>
</div>
