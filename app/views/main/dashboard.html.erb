<%= content_for :full_width_page_header do %>
  <%= render partial: 'content/components/parallax_universe_header' %>
<% end %>

<%= content_for :full_width_page_content do %>
  <div class="row">  
    <%= render partial: 'main/dashboard_header_links' %>
  </div>
<% end %>
<div class="row">
  <div class="col s12 m7 l8">
    <div class="grey-text uppercase center">
      Expand
      <% if @universe_scope.present? %>
        <%= link_to @universe_scope.name, @universe_scope, class: "#{Universe.color}-text" %>
      <% else %>
        your worlds
      <% end %>
    </div>
    <% if @content %>
      <%= render partial: 'cards/serendipitous/content_question', locals: { 
        content: @content, 
        field: @attribute_field_to_question,
        expand_by_default: true,
        include_quick_reference: true
      } %>
    <% end %>

    <%= link_to prompts_path do %>
      <div class="hoverable card-panel orange white-text" style="margin: 0; margin-bottom: 2em">
        <i class="material-icons left">lightbulb_outline</i>
        <i class="material-icons right">arrow_right</i>
        View more prompts
        <% if @universe_scope.present? %>
          in this universe
        <% end %>
      </div>
    <% end %>

    <% if @universe_scope.present? %>
      <%# in-universe stuff %>
    <% else %>
      <%
        accessible_universes = ((@current_user_content['Universe'] || []) + current_user.contributable_universes)
        if accessible_universes.count > 1
      %>
        <div class="grey-text uppercase center">
          Focus on one universe at a time
        </div>

        <%= render partial: 'notice_dismissal/messages/16' %>

        <% accessible_universes.sort_by { |u| u.name.downcase }.each do |universe| %>
          <div class="col s12 m6 l4">
            <%= link_to "?universe=#{universe.id}" do %>
              <div class="hoverable card">
                <div class="card-image">
                  <%= image_tag universe.random_image_including_private %>
                    <div class="card-title">
                      <%= universe.name %>
                    </div>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="col s12 m5 l4">
    <% if @recently_edited_pages.any? %>
      <div class="grey-text uppercase center">
        Pick up where you left off
      </div>
      <ul style="margin: 0;">
        <% @recently_edited_pages.first(5).each do |page| %>
          <% klass = content_class_from_name(page.page_type) %>
          <%= link_to main_app.send("edit_#{page.page_type.downcase}_path", page.id), class: "#{klass.color}-text" do %>
            <li class="card-panel hoverable" style="margin-bottom: 0.5em; border-left: 5px solid <%= klass.hex_color %>">
              <i class="material-icons left <%= klass.color %>-text" style="font-size: 3em;"><%= klass.icon %></i>
              <%= page.name %>
              <div class="grey-text">
                last edited
                <%= time_ago_in_words page.updated_at %>
                ago
              </div>
            </li>
          <% end %>
        <% end %>
      </ul>
      <div class="center" style="margin-bottom: 2em">
        <%= link_to 'view more', '#', class: 'sidenav-trigger', data: { target: 'recent-edits-sidenav' } %>
      </div>
    <% end %>

    <div class="grey-text uppercase center">Create something new</div>
    <% @activated_content_types.sample(3).each do |type| %>
      <% klass = content_class_from_name(type) %>
      <div>
        <%= link_to send("new_#{type.downcase}_path"), class: "white-text", style: 'width: 100%' do %>
          <div class="hoverable card-panel <%= klass.color %>">
            <div class="valign-wrapper">
              <i class="material-icons grey-bordered-text" class="left" style="font-size: 3em;"><%= klass.icon %></i>
              <span style="font-size: 1.1em; margin-left: 1em">
                New
                <%= type %><br />
                <small>
                  You've created
                  <%= pluralize (@current_user_content[type] || []).count, type.downcase %>
                  <% if @universe_scope %>
                    in this universe
                  <% end %>
                </small>
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<%= render partial: 'javascripts/content_linking' %>
